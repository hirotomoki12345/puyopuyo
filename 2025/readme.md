ぷよぷよ風落ちものパズル ゲーム設計詳細

1. 概要
本ゲームは HTML5 Canvas を使用して『ぷよぷよ』風の落ちものパズルを実装する。
ゲームの構成は以下の3つのファイルに分割し、それぞれの役割を明確にする。

index.html：画面描画・Canvas設定
config.js：ゲーム設定（速度・ボーナス値など）
game.js：ゲームロジック・描画処理
また、画像やサウンド素材を格納する assets フォルダを用意する。

2. ファイル構成
puyo_game/
index.html（ゲーム画面とCanvas設定）
config.js（ゲーム設定を管理）
game.js（ゲームロジックと描画処理）
assets/（画像やサウンド素材を管理）
img/（ぷよの画像）
ui/（UI画像：背景、スコアボードなど）
sound/（効果音：連鎖音など）
3. 画面レイアウト
ゲーム画面は Canvas を使用し、以下のようなレイアウトとする。

画面 右上 に Nextぷよを表示
画面 中央 に 12×6のグリッドで構成されたゲームフィールドを配置
画面 下部 にスコア（得点・連鎖数）を表示
Nextぷよ表示
次に落ちてくるぷよを右上に表示

ゲームフィールド
フィールドは 縦12×横6マス の固定グリッドで構成される。
1マスごとのサイズを config.js で設定し、ぷよをマス単位で描画する。

スコア表示
画面の下部にスコアを表示し、得点や連鎖数を管理する。

4. ゲームの流れ
ぷよの生成

Nextぷよを現在のぷよにセットし、新たなNextぷよをランダム生成
プレイヤー操作

移動（←→キー）
回転（Z/Xキー）
落下（↓キー）
ぷよの接着

ぷよが床または他のぷよに接触すると固定
消去判定

4つ以上同じ色が上下左右に接続すると消滅
連鎖処理

連鎖が続く限り落下と消去を繰り返す
ゲームオーバー判定

ぷよが 13段目 を超えて積まれるとゲームオーバー
5. 操作仕様
キー操作
左移動：←キー
右移動：→キー
ソフトドロップ：↓キー
ハードドロップ：スペースキー
左回転：Zキー
右回転：Xキー
回転時の制約
壁ずらし回転 を試みる（1マス横にずらして回転）
それでも回転できない場合は回転不可
固定猶予
ぷよが接地しても 30フレーム（0.5秒） は操作可能
6. ぷよの消去とスコア
消去条件
ぷよが4つ以上繋がると消える
上のぷよが落ちて新たに4つ以上繋がると連鎖発生
スコア計算
スコアの計算式は以下の通り

消したぷよの数 × (連鎖ボーナス + 連結ボーナス + 色数ボーナス) × 10

連鎖ボーナス
連鎖数	ボーナス
1連鎖	0
2連鎖	8
3連鎖	16
連結ボーナス
ぷよ数	ボーナス
4個	0
5個	2
色数ボーナス
色数	ボーナス
1色	0
2色	3
7. 設定ファイル（config.js）
fallSpeed：落下速度
lockDelay：固定までの猶予時間
raiseLimitPerTurn：回転で持ち上げ可能な回数
rotateBufferTime：0.5秒以内に2回回転すると180度回転
js
コピーする
編集する
const config = {
  fallSpeed: 1,          // 落下速度
  lockDelay: 30,         // 固定までの猶予時間
  raiseLimitPerTurn: 6,  // 回転で持ち上げ可能な回数
  rotateBufferTime: 30,  // 0.5秒以内に2回回転で180度回転
};
8. 画像管理
画像ファイルのパス
img/{色}/image_({色番号}-{アセット番号}).png

色番号
色	番号
赤	1
緑	2
青	3
黄	4
紫	5
アセット番号
番号	連結方向
1	通常（連結なし）
2	下のみ
3	上のみ
4	上下
5	右のみ
6	右下
7	右上
8	上下右
9	左のみ
10	左下
11	左上
12	上下左
13	左右
14	左右下
15	左右上
16	左右上下
ぷよの大きさは config.js で調節できるようにし、すべて同じ大きさにする。
画像の大きさが違っても統一して表示されるようにする。

9. ぷよの挙動とアニメーション
回転時に、ぷよや壁・床があって回転できない場合は 横や上にずらせないか確認 し、可能ならずらして回転させる
回転と落下は 滑らかにアニメーション させる（カクカクした動作を避ける）
処理順序は以下の通り
プレイヤーがぷよを配置し、操作時間が終了したら固定
ぷよが 宙に浮いていないか確認 し、浮いているなら滑らかに落下
落下し終わったら消去判定
消える場合はぷよを消す
ぷよを消したら 再度落下を確認 し、消えるか判定
ぷよが消えなくなったら Nextぷよを生成 し、プレイヤーが操作可能になる
10. まとめ
この設計を基に HTML5 Canvas でぷよぷよ風ゲームを実装する。
次のステップとして、index.html、config.js、game.js のコーディングを行う。
